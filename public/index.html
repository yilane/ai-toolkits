<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI工具集 - 智能工具平台</title>
    <meta name="description" content="AI工具集是一个集成了多种智能工具的平台，提供图像处理、文本转换、格式转换等功能">
    <meta name="keywords" content="AI工具,图像处理,文本处理,格式转换,在线工具">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    
    <!-- Styles -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/themes.css">
    <link rel="stylesheet" href="./css/responsive.css">
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在加载应用...</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">AI</div>
                <span>AI工具集</span>
            </div>
            
            <div class="search-container">
                <input type="text" 
                       class="search-input" 
                       placeholder="搜索工具..." 
                       id="searchInput"
                       autocomplete="off">
                <span class="search-icon">🔍</span>
            </div>
            
            <div class="header-actions">
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="菜单">☰</button>
                <button class="theme-toggle" id="themeToggle" aria-label="切换主题">🌙</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">工具分类</h2>
            </div>
            
            <nav>
                <ul class="nav-list" id="navList">
                    <!-- Navigation items will be populated by JavaScript -->
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <div class="main-header">
                <h1 class="main-title">AI工具集</h1>
                <p class="main-subtitle">发现最实用的AI工具，提升您的工作效率</p>
            </div>

            <!-- Tools Grid -->
            <div class="tools-grid" id="toolsGrid">
                <!-- Tool cards will be populated by JavaScript -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon">🔍</div>
                <p>未找到相关工具</p>
                <small>尝试使用不同的关键词或查看其他分类</small>
            </div>
        </main>
    </div>

    <!-- Tool Modal -->
    <div class="tool-modal" id="toolModal" style="display: none;">
        <div class="tool-modal-overlay"></div>
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2 class="tool-modal-title" id="toolModalTitle">工具</h2>
                <button class="tool-modal-close" id="toolModalClose" aria-label="关闭">&times;</button>
            </div>
            <div class="tool-modal-body" id="toolModalBody">
                <!-- Tool UI will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Simple inline application to avoid module path issues
        class SimpleAIToolkit {
            constructor() {
                this.currentTheme = localStorage.getItem('ai-toolkit-theme') || 'light';
                this.currentCategory = 'all';
                this.tools = [];
                this.categories = [];
                this.searchQuery = '';
                
                this.init();
            }

            async init() {
                try {
                    // Load configurations
                    await this.loadConfigs();
                    
                    // Initialize theme
                    this.applyTheme(this.currentTheme);
                    
                    // Render UI
                    this.renderSidebar();
                    this.renderTools();
                    
                    // Bind events
                    this.bindEvents();
                    
                    // Hide loading
                    document.getElementById('loading').style.display = 'none';
                    
                    console.log('AI Toolkit initialized successfully');
                } catch (error) {
                    console.error('Failed to initialize:', error);
                    document.getElementById('loading').innerHTML = '<div class="loading-text">加载失败，请刷新页面重试</div>';
                }
            }

            async loadConfigs() {
                try {
                    const [toolsResponse, categoriesResponse] = await Promise.all([
                        fetch('./config/tools.json'),
                        fetch('./config/categories.json')
                    ]);

                    const toolsConfig = await toolsResponse.json();
                    const categoriesConfig = await categoriesResponse.json();

                    this.tools = toolsConfig.tools || [];
                    this.categories = categoriesConfig.categories || [];
                } catch (error) {
                    console.error('Failed to load configs:', error);
                    // Fallback data
                    this.categories = [
                        { id: 'all', name: '全部工具', icon: '🏠' },
                        { id: 'image', name: '图像处理', icon: '🖼️' },
                        { id: 'text', name: '文本处理', icon: '📝' },
                        { id: 'converter', name: '格式转换', icon: '🔄' },
                        { id: 'ai', name: 'AI生成', icon: '🤖' }
                    ];
                    
                    this.tools = [
                        {
                            id: 'image-compress',
                            name: '压缩图像文件',
                            description: '压缩JPG、PNG、SVG、以及GIF，同时节省空间，保持质量。',
                            category: 'image',
                            icon: '🗜️',
                            iconColor: '#10B981',
                            enabled: true
                        },
                        {
                            id: 'image-resize',
                            name: '调整图像的大小',
                            description: '按照百分比或像素来定义尺寸，并调整JPG、PNG、SVG和GIF图片的尺寸。',
                            category: 'image',
                            icon: '📏',
                            iconColor: '#3B82F6',
                            enabled: true
                        },
                        {
                            id: 'image-crop',
                            name: '裁剪图片',
                            description: '通过设定像素来裁剪图像文件。裁剪JPG文件、PNG文件或GIF图像文件。',
                            category: 'image',
                            icon: '✂️',
                            iconColor: '#06B6D4',
                            enabled: true
                        },
                        {
                            id: 'format-converter',
                            name: '格式转换',
                            description: '转换图像文件格式，支持JPG、PNG、GIF等格式互转。',
                            category: 'converter',
                            icon: '🔄',
                            iconColor: '#F59E0B',
                            enabled: true
                        }
                    ];
                }
            }

            renderSidebar() {
                const navList = document.getElementById('navList');
                if (!navList) return;

                navList.innerHTML = '';

                this.categories.forEach(category => {
                    const toolCount = category.id === 'all' 
                        ? this.tools.filter(tool => tool.enabled).length
                        : this.tools.filter(tool => tool.category === category.id && tool.enabled).length;

                    const navItem = document.createElement('li');
                    navItem.className = 'nav-item';
                    
                    navItem.innerHTML = `
                        <a href="#" class="nav-link ${category.id === this.currentCategory ? 'active' : ''}" data-category="${category.id}">
                            <span class="nav-icon">${category.icon}</span>
                            <span>${category.name}</span>
                            <span class="nav-count">${toolCount}</span>
                        </a>
                    `;

                    navList.appendChild(navItem);
                });
            }

            renderTools() {
                const toolsGrid = document.getElementById('toolsGrid');
                const emptyState = document.getElementById('emptyState');
                
                if (!toolsGrid) return;

                // Filter tools
                let filteredTools = this.tools.filter(tool => tool.enabled);
                
                if (this.currentCategory !== 'all') {
                    filteredTools = filteredTools.filter(tool => tool.category === this.currentCategory);
                }

                if (this.searchQuery) {
                    const query = this.searchQuery.toLowerCase();
                    filteredTools = filteredTools.filter(tool => 
                        tool.name.toLowerCase().includes(query) ||
                        tool.description.toLowerCase().includes(query)
                    );
                }

                // Clear grid
                toolsGrid.innerHTML = '';

                if (filteredTools.length === 0) {
                    emptyState.style.display = 'block';
                    return;
                } else {
                    emptyState.style.display = 'none';
                }

                // Generate tool cards
                filteredTools.forEach(tool => {
                    const toolCard = this.createToolCard(tool);
                    toolsGrid.appendChild(toolCard);
                });
            }

            createToolCard(tool) {
                const card = document.createElement('a');
                card.className = 'tools-item';
                card.href = '#';
                card.dataset.toolId = tool.id;
                
                card.innerHTML = `
                    <div class="tools-item-icon" style="background-color: ${tool.iconColor}20; color: ${tool.iconColor}">
                        ${tool.icon}
                    </div>
                    <h3>${tool.name}</h3>
                    <div class="tools-item-content">
                        <p>${tool.description}</p>
                        ${tool.isNew ? '<span class="tools-item-badge new">新功能！</span>' : ''}
                    </div>
                `;

                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.openTool(tool);
                });

                return card;
            }

            openTool(tool) {
                const modal = document.getElementById('toolModal');
                const title = document.getElementById('toolModalTitle');
                const body = document.getElementById('toolModalBody');

                if (title) title.textContent = tool.name;
                if (body) {
                    body.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">${tool.icon}</div>
                            <h3>${tool.name}</h3>
                            <p style="color: var(--text-secondary); margin: 16px 0;">${tool.description}</p>
                            <p style="color: var(--text-muted); font-size: 14px;">该工具功能正在开发中，敬请期待！</p>
                            <button onclick="app.closeTool()" style="margin-top: 24px; padding: 8px 16px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">关闭</button>
                        </div>
                    `;
                }
                
                if (modal) modal.style.display = 'flex';
            }

            closeTool() {
                const modal = document.getElementById('toolModal');
                if (modal) modal.style.display = 'none';
            }

            bindEvents() {
                // Theme toggle
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => {
                        this.toggleTheme();
                    });
                }

                // Search
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchQuery = e.target.value.trim();
                        this.renderTools();
                    });
                }

                // Category navigation
                document.addEventListener('click', (e) => {
                    if (e.target.matches('.nav-link') || e.target.closest('.nav-link')) {
                        e.preventDefault();
                        const link = e.target.closest('.nav-link');
                        const category = link.dataset.category;
                        
                        if (category) {
                            this.currentCategory = category;
                            this.updateActiveCategory();
                            this.renderTools();
                        }
                    }
                });

                // Mobile menu
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const sidebar = document.getElementById('sidebar');
                
                if (mobileMenuBtn && sidebar) {
                    mobileMenuBtn.addEventListener('click', () => {
                        sidebar.classList.toggle('mobile-open');
                    });
                }

                // Modal close
                const modalClose = document.getElementById('toolModalClose');
                const modalOverlay = document.querySelector('.tool-modal-overlay');
                
                if (modalClose) {
                    modalClose.addEventListener('click', () => this.closeTool());
                }
                
                if (modalOverlay) {
                    modalOverlay.addEventListener('click', () => this.closeTool());
                }

                // Escape key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeTool();
                    }
                });
            }

            updateActiveCategory() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-category="${this.currentCategory}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                this.applyTheme(this.currentTheme);
                localStorage.setItem('ai-toolkit-theme', this.currentTheme);
            }

            applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.textContent = theme === 'light' ? '🌙' : '☀️';
                }
            }
        }

        // Initialize app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new SimpleAIToolkit();
        });
    </script>
</body>
</html>